---
output:
  github_document:
    html_preview: false
---

```{r setup, include=FALSE, message=FALSE}
library(knitr)
library(here)
library(tidyverse)

warn_ok <- NULL

ok_cast <- readRDS(here("data", "ok_cast.rds"))
dat_ok <- readRDS(here("data", "ok_dat.rds"))
ok_counts <- readRDS(here("data", "ok_counts.rds"))

ok_cast_table <- ok_cast %>% 
  mutate(words = words %>% format(big.mark = ","),
         `one in every n words` = `one in every n words` %>%
           round() %>% 
           format(big.mark = ",")) %>%
  kable(format = 'pipe',
        digits = c(0, 0, 0, 0, 2, 6, 0),
        align = "lrrrrrr")

colnames(ok_cast) <- c("name", "count", "attended", "words", "per_episode", "per_word", "one_in_every")

dat_Ashley <- dat_ok %>%
  group_by(Ashley) %>%
  summarise(n = mean_cl_boot(n))

wc_Ashley <- wilcox.test(n ~ Ashley,
  data = dat_ok
)

ok_max <- ok_counts %>% 
  filter(n == max(n))
```

## "Okay, Okay, Okay": Who said it and When?

"Okay, Okay, Okay" has been said a lot over the two campaigns of Critical Role. Looking just at the main campaign episodes, and only during gameplay, it has been said `r sum(ok_cast$count)` times to be exact! It is most associated with Ashley, but does she say it the most? And has the frequency with which it is said changed over the campaigns?


#### Who says "Okay, Okay, Okay" the most?

`r ok_cast_table`

```{r}
ashley_count_rank <- which(ok_cast %>% 
                             arrange(desc(count)) %>% 
                             pull(name) == "Ashley")

higher_count_rank <- ok_cast %>% 
  arrange(desc(count)) %>% 
  ungroup() %>% 
  filter(rank(-count) < ashley_count_rank) %>% 
  pull(name)

if(ashley_count_rank == 1) {
  rank_text <- str_c("It turns out that Ashley (",
                     ok_cast$count[ok_cast$name == "Ashley"],
                     ") has said it more times than any other cast member. ")
} else {
  rank_text <- "It turns out that "
  if(length(higher_count_rank) == 1) {
    rank_text <- str_c(rank_text,
                       higher_count_rank,
                       " (",
                       ok_cast$count[ok_cast$name == higher_count_rank],
                       ') has said "Okay, Okay, Okay" more times than Ashley (',
                        ok_cast$count[ok_cast$name == "Ashley"],
                       "). ")
  } else {
    higher_count_text <- ok_cast %>% 
      arrange(desc(count)) %>% 
      ungroup() %>% 
      filter(rank(-count) < ashley_count_rank) %>% 
      mutate(text = str_c(name, " (", count, ")")) %>%
      pull(text)
    
    if(length(higher_count_text == 2)) {
      rank_text <- str_c(rank_text,
                         "both ",
                         higher_count_text %>% 
                           str_flatten(collapse = " and "),
                         ' have said "Okay, Okay, Okay" more times than Ashley (',
                         ok_cast$count[ok_cast$name == "Ashley"],
                         "). ")
    } else {
      list_text <- str_c(higher_count_text[1:(length(higher_count_text) - 1)] %>% 
                           str_flatten(collapse = ", "),
                         higher_count_text[length(higher_count_text)],
                         sep = " and ")
      
      rank_text <- str_c(rank_text,
                         list_text,
                         ' have said "Okay, Okay, Okay" more times than Ashley (',
                         ok_cast$count[ok_cast$name == "Ashley"],
                         "). ")
    }
  }
}

if(ashley_count_rank == 1) {
  episodes_text <- ""
} else if(sum(ok_cast$attended[ok_cast$name %in% higher_count_rank] >
              ok_cast$attended[ok_cast$name == "Ashley"]) == 
          length(higher_count_rank)) {
  episodes_text <- str_c("However, they were present for more episodes than Ashley")
  
  if(sum(ok_cast$words[ok_cast$name %in% higher_count_rank] >
              ok_cast$words[ok_cast$name == "Ashley"]) == 
     length(higher_count_rank)) {
    episodes_text <- str_c(episodes_text,
                           ", and have said many more words than Ashley. ")
  } else {
    episodes_text <- str_c(episodes_text,
                           ". ")
  }
} else {
  episodes_text <- ""
  warn_ok <- "episodes_text"
}

per_ep_text <- "If we look at how many times they said it per episode they were in, "

if(ok_cast$per_episode[ok_cast$name == "Ashley"] == max(ok_cast$per_episode)) {
  per_ep_text <- str_c(per_ep_text,
                       "Ashley comes out on top, averaging ",
                       ok_cast$per_episode[ok_cast$name == "Ashley"] %>% 
                         format(digits = 3),
                       ' "Okay, Okay, Okay"s per episode. ')
} else if(length(higher_count_rank) > 0) {
  top_per_ep <- ok_cast$name[ok_cast$per_episode == max(ok_cast$per_episode)]
  
  per_ep_text <- str_c(per_ep_text,
                       top_per_ep,
                       " comes out on top, averaging ",
                       ok_cast$per_episode[ok_cast$name == top_per_ep] %>% 
                         format(digits = 3),
                        ' "Okay, Okay, Okay"s per episode, with ')
  
  if(length(higher_count_rank) > 1) {
    per_ep_names <- higher_count_rank[higher_count_rank != top_per_ep] %>% 
      str_c(sep = ", ")
    
    per_ep_scores <- ok_cast$per_episode[ok_cast$name %in% 
                                            higher_count_rank[higher_count_rank != top_per_ep]]  %>% 
                         format(digits = 3) %>% 
      str_c(sep = ", ")
    
    per_ep_text <- str_c(per_ep_text,
                         str_c(per_ep_names, 
                               " and Ashley averaging "),
                         str_c(per_ep_scores,
                               ok_cast$per_episode[ok_cast$name == "Ashley"][ok_cast$name == "Ashley"] %>% 
                         format(digits = 3),
                               sep = " and "),
                         " respectively. ")
  } else {
    per_ep_text <- str_c(per_ep_text,
                         "Ashley averaging ",
                         ok_cast$per_episode[ok_cast$name == "Ashley"] %>% 
                         format(digits = 3),
                         ". ")
  }
}

per_word_text <- "But if we look at the total number of words they said, "

if(ok_cast$per_word[ok_cast$name == "Ashley"] == max(ok_cast$per_word)) {
  per_word_text <- str_c(per_word_text,
                         "we see that Ashley (",
                         ok_cast$words[ok_cast$name == "Ashley"] %>% 
                           format(big.mark = ","),
                         ") said fewer words than ")
  if(length(higher_count_rank) > 1) {
    higher_names <- higher_count_rank
    
    word_scores <- ok_cast$words[ok_cast$name %in% higher_count_rank]  %>% 
      format(big.mark = ",") %>% 
      str_c(sep = ", ")
    
    # per_ep_text <- str_c(per_ep_text,
    #                      str_c(per_ep_names, 
    #                            " and Ashley averaging "),
    #                      str_c(per_ep_scores,
    #                            ok_cast$per_episode[ok_cast$name == "Ashley"][ok_cast$name == "Ashley"] %>% 
    #                      format(digits = 3),
    #                            sep = " and "),
    #                      " respectively. ")
    
    word_name_scores <- ""
    for(i in seq_along(higher_names)) {
      word_name_scores[i] <- str_c(higher_names[i],
                                   " (",
                                   word_scores[i],
                                   ")")     
    }
    
    if(length(higher_names) < 2) {
      per_word_text <- str_c(per_word_text,
                           word_name_scores,
                           ". ")
    } else {
      per_word_text <- str_c(per_word_text,
                           str_c(word_name_scores[1:(length(word_name_scores) - 1)],
                                 sep = ", "),
                           " or ",
                           word_name_scores[length(word_name_scores)],
                           ". ")
    }

  }
} else {
  warn_ok <- "per_word_text"
  per_word_text <- ""
}

```

<!-- It turns out that both Laura (`r ok_cast$count[ok_cast$name == "Laura"]`) and Marisha (`r ok_cast$count[ok_cast$name == "Marisha"]`) have said "Okay, Okay, Okay" more times than Ashley (`r ok_cast$count[ok_cast$name == "Ashley"]`). -->
<!-- However, they both were present for more episodes, and have said many more words than Ashley.  -->
<!-- If we look at how many times they said it per episode they were in, Laura still comes out on top, averaging `r ok_cast$per_episode[ok_cast$name == "Laura"] %>% format(digits = 3)` "Okay, Okay, Okay"s per episode, with Marisha and Ashley averaging `r ok_cast$per_episode[ok_cast$name == "Marisha"] %>% format(digits = 3)` and `r ok_cast$per_episode[ok_cast$name == "Ashley"] %>% format(digits = 3)` respectively.  -->
<!-- But if we look at the total number of words they said, we see that Ashley (`r ok_cast$words[ok_cast$name == "Ashley"] %>% format(big.mark = ",")`) said fewer words than either Laura (`r ok_cast$words[ok_cast$name == "Laura"] %>% format(big.mark = ",")`) or Marisha (`r ok_cast$words[ok_cast$name == "Marisha"] %>% format(big.mark = ",")`).  -->

`r rank_text` `r episodes_text` `r per_ep_text` `r per_word_text`

Taking this into account, we find that 1 in every `r ok_cast$one_in_every[ok_cast$name == "Ashley"] %>% round()` words that Ashley said was part of "Okay, Okay, Okay", compared to 1 in every `r ok_cast$one_in_every[ok_cast$name == "Laura"] %>% round()` for Laura, and 1 in every `r ok_cast$one_in_every[ok_cast$name == "Marisha"] %>% round()` for Marisha. So while Ashley may not have said it the most, she did have the highest frequency of "Okay, Okay, Okay" in her dialogue.

Another interesting point is that if we compare the number of times per episode "Okay, Okay, Okay" is said when Ashley is present versus when she is absent, we see that "Okay, Okay, Okay" is said an average of `r dat_Ashley$n$y[dat_Ashley$Ashley == TRUE] %>% format(digits = 3)` times per episode when Ashley is there, and only `r dat_Ashley$n$y[dat_Ashley$Ashley == FALSE] %>% format(digits = 3)` times per episode when she is absent. This is an average increase of `r abs(dat_Ashley$n$y[dat_Ashley$Ashley == FALSE] - dat_Ashley$n$y[dat_Ashley$Ashley == TRUE]) %>% format(digits = 3)` times per episode when Ashley is present, but Ashley herself only averages `r ok_cast$per_episode[ok_cast$name == "Ashley"] %>% format(digits = 3)` "Okay, Okay, Okay"s per episode. This suggests that having Ashley at the table results in the other cast members saying "Okay, Okay, Okay" more often! And a Wilcoxon rank sum test confirms that "Okay, Okay, Okay" is said at a statistically significant higher rate when Ashley is present (*p* = `r wc_Ashley$p.value %>% format(digits = 3)`). However, as shown in the next section, it is difficult to untangle this from the change in the frequency of "Okay, Okay, Okay" over the two campaigns, and Ashley's more frequent presence in the later episodes of campaign 2.

#### Has the use of "Okay, Okay, Okay" changed over time?

![Okay](../plots/okay_okay_okay.png)

We see in the figure that "Okay, Okay, Okay" was said at a fairly low rate during campaign 1, and didn't change much from start to finish. Campaign 2, however, started at about the same rate campaign 1 ended at, but increased substantially as it progressed. The most times "Okay, Okay, Okay" was said during an episode was campaign `r ok_max$campaign` episode `r ok_max$episode`, when it was said `r ok_max$n` times.